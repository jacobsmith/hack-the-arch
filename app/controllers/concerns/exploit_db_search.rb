require 'csv'

class ExploitDbSearch
  HEADERS = %w(id file description date author platform type port)

  def self.git_top_level_dir
    `git rev-parse --show-toplevel`.chomp
  end

  def self.exploit_database_dir
    "#{git_top_level_dir}/lib/exploit-database"
  end

  def self.search(term)
    parse(`grep #{term} #{exploit_database_dir}/files.csv`)
  end

  def self.load(exploit_id)
    results = self.search(exploit_id)
    info = results.find { |row| row["id"] == exploit_id }
    info["file_contents"] = File.read("#{exploit_database_dir}/#{info["file"]}")
    info
  end

  private

  def self.parse(data)
    CSV.new(data, headers: HEADERS)
  end

end
